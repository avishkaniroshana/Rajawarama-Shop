package com.rajawarama.backend.controller;

import com.rajawarama.backend.dto.DressItemResponse;
import com.rajawarama.backend.service.DressItemService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import java.util.List;
import java.util.Map;
import java.util.UUID;

@RestController
@RequestMapping("/api/admin/dress-items")
@RequiredArgsConstructor
@PreAuthorize("hasRole('ADMIN')")
public class AdminDressItemController {

    private final DressItemService dressItemService;

    // ==============================
    // CREATE
    // ==============================
    @PostMapping
    public ResponseEntity<DressItemResponse> create(
            @RequestParam String dressName,
            @RequestParam UUID categoryId,
            @RequestParam MultipartFile image
    ) {
        return ResponseEntity.ok(
                dressItemService.create(dressName, categoryId, image)
        );
    }

    // ==============================
    // UPDATE
    // ==============================
    @PutMapping("/{dressItemId}")
    public ResponseEntity<DressItemResponse> update(
            @PathVariable UUID dressItemId,
            @RequestParam String dressName,
            @RequestParam UUID categoryId,
            @RequestParam(required = false) MultipartFile image
    ) {
        return ResponseEntity.ok(
                dressItemService.update(dressItemId, dressName, categoryId, image)
        );
    }

    // ==============================
    // GET ALL
    // ==============================
    @GetMapping
    public ResponseEntity<List<DressItemResponse>> getAll() {
        return ResponseEntity.ok(dressItemService.getAll());
    }

    // ==============================
    // GET BY ID
    // ==============================
    @GetMapping("/{dressItemId}")
    public ResponseEntity<DressItemResponse> getById(
            @PathVariable UUID dressItemId
    ) {
        return ResponseEntity.ok(
                dressItemService.getById(dressItemId)
        );
    }

    // ==============================
    // DELETE
    // ==============================
    @DeleteMapping("/{dressItemId}")
    public ResponseEntity<?> delete(@PathVariable UUID dressItemId) {
        dressItemService.delete(dressItemId);

        return ResponseEntity.ok(
                Map.of("message", "Dress item deleted successfully")
        );
    }
}